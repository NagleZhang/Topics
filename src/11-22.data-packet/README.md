# 自己写的
分层这个词本身是一个很抽象的概念. 
什么叫做分层? 我们假设你会经常在一个网络环境不太好的地方, 和你的朋友发信息.而且不能确定你的消息是否能够发送到朋友那边. 所以, 你和你的朋友约定了, 你发送的消息, 必然会得到回复, 如果没有回复的话, 就是没有收到这条消息, 你就需要重新发送一遍.直到收到你朋友的消息为止. 你的朋友这边也遵守了同样的规则. 
把这个规则抽象话一点, 就是, 你们通过口头的协议: 如果没有收到回复, 1分钟重试. 于是, 你和你的朋友就在传统的TCI/IP的基础上再搭建了一层, 为什么可以把它称之为一层呢? 
因为现在这个规则, 无论我们现在使用的应用是微信, qq , 还是支付宝, 都可以工作.我们说它和应用层是无关的, 我们把这一层称之为: 嘴层
所以说, 没有什么问题是分层解决不了的, 如果有, 就再分一层. 
我们直接来看看 TCP/IP 协议是如何分层的
在网络上流传的, 是一个又一个的数据包. 而每一个数据包, 都包含上面四层的信息, 当然, 你和你朋友协商的协议本身, 没有落实到代码中, 也就没有在数据包中体现. 
那么, 我们来直接抓取其中一个数据包, 来看看里面到底有什么? 以及这些, 怎么对应到我们现有的网络协议当中. 
首先是物理链路层有两个关键信息,一个是目标的物理地址 (00 08 e3 ff fd 90) = dst 另外一个是源头的物理地址,(ac c9 06 21 3a 9c) src 还有, 我们要选择的网络层的协议信息, 也就是(08 00) == IPv4 
网络层有3个关键信息:  指定运输层的协议protocol = (06) 为 tcp, 然后源ip地址src=(0A 82 48 F2 10.11.11.11),以及目的地ip地址 dst=(68 12 24 40  104.18.36.64) 
运输层有两个关键信息:  源地址的端口src port = (00 14 = 20) 以及目标地址的端口 dst port = (00 50 = 80) ,
因为有了 ip 的基本信息后, 我们开始运输数据,有时候, 我们要运输的内容一个包可能不够, 所以会拆解成多个运输的包. 并在这一层进行组装.所以这一层称之为运输层, 很合理.
最后到了应用层: 47 45 54 20 2F 69 6E 64 65 78 2E 68 74 6D 6C 20 48 54 54 50 2F 31 2E 30 20 0A 0A , 
运输层将保证给我们的数据, 将是完整的, 正确的可以被应用解析的内容. 我们上面的二进制被解析后, 就变成了: GET /index.html HTTP/1.0
总结一下, 我们的这个数据包的基本信息如下: 一个从 10.11.11.11 的机器, 尝试访问 104.18.36.64 的 80 号端口, 并且尝试通过应用层的 HTTP/1.0 协议去执行 GET /index.html  
而, 可以看到, 我们将基本信息提取出来以后, 剩下的几层, 仍然有很多的数据没有去解析. 最多的, 便是 IP 与 TCP 的数据. 而这些涉及到 TCP 与 IP 的协议更多的控制功能. 
如果你喜欢这个类型的内容, 请不要忘记点赞投币, 让我知道你的喜好. 感谢你的支持!


# gpt 润色的
分层这个词本身是一个极为抽象的概念。何谓分层？
设想你常处于网络信号较差的地方，与朋友发送信息时，无法确保对方能够收到。
为此，你们约定每条发送的消息都必须得到回复，若1分钟无回复即意味着未收到，需要重发直至对方回应。双方均遵循这一规则。
因而，在TCP/IP协议的基础上，你和你的朋友实际上建立了一层新的规则, 我们将该层命名为: 嘴层。
称之为“层”的原因是什么呢？因为不论我们使用的是抖音, 微信还是skype，这个规则都同样适用。这说明它与应用层无关.
有话说，没有问题是通过增加层级无法解决的；如果有，那就再增加一层。

在网络中，流动的是一个个数据包。每个数据包都包含了这四层信息。
当然，你和朋友商定的协议并没有具体编写成代码，因此也未在数据包中体现出来。
现在，我们直接捕获一个数据包，深入探究其中包含了什么，以及这些内容是怎样对应到我们现有网络协议中的。
首先是物理链路层，它有两个关键信息：目标物理地址（00 08 e3 ff fd 90）即dst，以及源物理地址（ac c9 06 21 3a 9c）即src，并且还包括选择的网络层协议信息，也就是（08 00）代表IPv4。
网络层关键信息有三个：指定运输层的协议protocol =（06）表示tcp，
源IP地址src=(0A 82 48 F2 即10.11.11.11)，
以及目的地IP地址dst=(68 12 24 40 即104.18.36.64)。

运输层的两个关键信息是：源端口src port =（00 14 = 20）以及目标端口dst port =（00 50 = 80）。
有了IP的基本信息后，开始运输数据。有时数据量大到一个包装不下，会拆解成多个包传输，并在此层组装，因此称这一层为运输层很合理。

最后是应用层：运输层保证传递的数据完整、正确，并能被应用解析。上述二进制解析后变成了：GET /index.html HTTP/1.0。

总结这个数据包的基本信息如下：一台位于10.11.11.11的机器尝试访问104.18.36.64的80号端口，并通过应用层的HTTP/1.0协议执行GET /index.html操作。

可见，从基本信息提取之后，剩余几层仍有大量数据未解析，其中最多的是IP与TCP的数据，涉及TCP与IP协议的更多控制功能。
如果你喜欢这类内容，请别忘记点赞投币转发，并告诉我你的偏好。感谢你的支持！
